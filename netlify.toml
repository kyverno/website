[build]
  command = "yarn install --immutable && yarn build"
  publish = "dist"

  [build.environment]
    NODE_VERSION = "23.6.0"
    # Astro/Starlight don't use Go or Hugo, so those are omitted
    ASTRO_TELEMETRY_DISABLED = "1"
    SITE_URL = "https://kyverno.io/"

# --- Production (main branch) ---
[context.production]
  command = "yarn install --immutable && yarn build"
  publish = "dist"

  [context.production.environment]
    NODE_ENV = "production"
    SITE_URL = "https://kyverno.io/"
    ASTRO_ENV = "production"

# --- Deploy Previews (PRs) ---
[context.deploy-preview]
  command = "yarn install --immutable && yarn build"
  publish = "dist"

  [context.deploy-preview.environment]
    NODE_ENV = "development"
    ASTRO_ENV = "preview"
    SITE_URL = "$DEPLOY_PRIME_URL"

# --- Branch Deploys (non-main branches) ---
[context.branch-deploy]
  command = "yarn install --immutable && yarn build"
  publish = "dist"

  [context.branch-deploy.environment]
    NODE_ENV = "development"
    ASTRO_ENV = "branch"
    SITE_URL = "$DEPLOY_PRIME_URL"

# --- Redirects ---
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

# --- Headers ---
[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "SAMEORIGIN"

[[headers]]
  for = "/blog/index.xml"
  [headers.values]
    access-control-allow-origin = "*"