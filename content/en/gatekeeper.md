+++
description = "Migration guidelines with policy mappings"
title = "Gatekeeper Migration Guide"
type = "policies"
url = "/policies/gatekeeper/"
+++

<br/>

### Migration Strategy

A strategy for migration from Gatekeeper is to run both policy engines for some period of time, and incrementally migrate policies over to Kyverno. The Kyverno policies can be initially introduced in [`Audit` mode](/docs/applying-policies/) to assess results. Once ready, the Kyverno policies can be set to `Enforce` mode and the corresponding Gatekeeper policies can be removed.

Mutation policies may require additional consideration and testing, as running both engines may result in overwrites. For these, and for custom or complex policies, it is recommended that the Kyverno policies first be tested using the [Kyverno CLI test command](/docs/testing-policies/) and then deployed into a cluster.

### Gatekeeper to Kyverno Policy Mapping

The following table maps the [Gatekeeper library policies](https://github.com/open-policy-agent/gatekeeper-library) to the [Kyverno library policies](/policies). While there may be some minor variations in these mappings, anything more than tacit alterations are covered in the Notes section below the table.

| Name                                             | Gatekeeper                                                                                                                                                                                                                                              | Kyverno                                                                                                                                 |
|--------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------|
| Allowed image repositories                       | [allowedrepos](https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/allowedrepos)                                                                                                                                        | [Allowed Image Repositories](/policies/other/allowed-image-repos/allowed-image-repos/)                                                  |
| Automount ServiceAccount Token                   | [automount-serviceaccount-token](https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/automount-serviceaccount-token)                                                                                                    | [Restrict Auto-Mount of Service Account Tokens](/policies/other/restrict-automount-sa-token/restrict-automount-sa-token/)               |
| CVE-2021-25740                                   | [block-endpoint-edit-default-role](https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/block-endpoint-edit-default-role)                                                                                                | [Restrict Edit for Endpoints CVE-2021-25740](/policies/other/restrict-edit-for-endpoints/restrict-edit-for-endpoints/)                  |
| Disallow Service LoadBalancer                    | [block-loadbalancer-services](https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/block-loadbalancer-services)                                                                                                          | [Disallow Service Type LoadBalancer](/policies/other/restrict-loadbalancer/restrict-loadbalancer/)                                      |
| Disallow Service NodePort                        | [block-nodeport-services](https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/block-nodeport-services)                                                                                                                  | [Disallow NodePort](/policies/best-practices/restrict-node-port/restrict-node-port/)                                                    |
| Block Ingress with wildcards in host             | [block-wildcard-ingress](https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/block-wildcard-ingress)                                                                                                                    | [Restrict Ingress Host with Wildcards](/policies/other/restrict-ingress-wildcard/restrict-ingress-wildcard/)                            |
| Container limits                                 | [containerlimits](https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/containerlimits)                                                                                                                                  | [Require Limits and Requests](/policies/best-practices/require-pod-requests-limits/require-pod-requests-limits/)<sup>1</sup>            |
| Container requests                               | [containerrequests](https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/containerrequests)                                                                                                                              | [Require Limits and Requests](/policies/best-practices/require-pod-requests-limits/require-pod-requests-limits/)<sup>1</sup>            |
| Container resource ratios                        | [containerresourceratios](https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/containerresourceratios)                                                                                                                  | [Enforce Resources as Ratio](/policies/other/enforce-resources-as-ratio/enforce-resources-as-ratio/)                                    |
| Container resources                              | [containerresources](https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/containerresources)                                                                                                                            | [Require Limits and Requests](/policies/best-practices/require-pod-requests-limits/require-pod-requests-limits/)<sup>1</sup>            |
| Disallow anonymous                               | [disallowanonymous](https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/disallowanonymous)                                                                                                                              | [Restrict Binding System Groups](/policies/other/restrict-binding-system-groups/restrict-binding-system-groups/)                        |
| Allowed image tags                               | [disallowedtags](https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/disallowedtags)                                                                                                                                    | [Disallow Latest Tag](/policies/best-practices/disallow-latest-tag/disallow-latest-tag/)                                                |
| Service with ExternalIP                          | [externalip](https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/externalip)                                                                                                                                            | [Restrict External IPs](/policies/best-practices/restrict-service-external-ips/restrict-service-external-ips/)                          |
| Require Ingress with HTTPS                       | [httpsonly](https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/httpsonly)                                                                                                                                              | [Require Ingress HTTPS](/policies/other/require-ingress-https/require-ingress-https/)                                                   |
| Image digests                                    | [imagedigests](https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/imagedigests)                                                                                                                                        | [Require Images Use Checksums](/policies/other/require-image-checksum/require-image-checksum/)                                          |
| Restrict ServiceAccount updates                  | [noupdateserviceaccount](https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/noupdateserviceaccount)                                                                                                                    | [Restrict Pod Controller ServiceAccount Updates](/policies/other/restrict-pod-controller-serviceaccount-updates/restrict-pod-controller-serviceaccount-updates/)     |
| PodDisruptionBudget with non-zero maxUnavailable | [poddisruptionbudget](https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/poddisruptionbudget)                                                                                                                          | [PodDisruptionBudget maxUnavailable Non-Zero](/policies/other/pdb-maxunavailable/pdb-maxunavailable/)                                   |
| Replicas don't match PDB minAvailable            | [poddisruptionbudget](https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/poddisruptionbudget)                                                                                                                          | [Check PodDisruptionBudget minAvailable](/policies/other/pdb-minavailable/pdb-minavailable/)                                            |
| Replica range                                    | [replicalimits](https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/replicalimits)                                                                                                                                      | [Require Multiple Replicas](/policies/other/require-deployments-have-multiple-replicas/require-deployments-have-multiple-replicas/)<sup>2</sup> |
| Require annotations                              | [requiredannotations](https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/requiredannotations)                                                                                                                          | [Require Annotations](/policies/other/require-annotations/require-annotations/)<sup>3</sup>                                             |
| Require labels                                   | [requiredlabels](https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/requiredlabels)                                                                                                                                    | [Require Labels](/policies/best-practices/require-labels/require-labels/)<sup>3</sup>                                                   |
| Metadata regex                                   | [requiredannotations](https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/requiredannotations) and [requiredlabels](https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/requiredlabels) | [Metadata Matches Regex](/policies/other/metadata-match-regex/metadata-match-regex/)<sup>3</sup>                                        |
| Require Pod probes                               | [requiredprobes](https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/requiredprobes)                                                                                                                                    | [Require Pod Probes](/policies/best-practices/require-probes/require-probes/)                                                           |
| Require StorageClass                             | [storageclass](https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/storageclass)                                                                                                                                        | [Require StorageClass](/policies/other/require-storageclass/require-storageclass/)                                                      |
| Require unique Ingress hosts                     | [uniqueingresshost](https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/uniqueingresshost)                                                                                                                              | [Unique Ingress Host](/policies/other/restrict-ingress-host/restrict-ingress-host/)                                                     |
| Unique Service selector                          | [uniqueserviceselector](https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/general/uniqueserviceselector)                                                                                                                      | [Require Unique Service Selector](/policies/other/require-unique-service-selector/require-unique-service-selector/)                     |

The Gatekeeper [pod-security-policy](https://github.com/open-policy-agent/gatekeeper-library/tree/master/library/pod-security-policy) grouping maps roughly to the [Pod Security Standard policies](/policies/pod-security/) which they supersede.

### Notes

1. The equivalent Kyverno policy does not enforce CPU limits as this is not a typical best practice, however this can easily be added. It also does not require those limits be under a certain threshold which the Gatekeeper policy defines. A separate rule can be added to ensure the values are under a given amount.
2. The Kyverno policy can easily be modified to accommodate a range rather than a greater-than-zero check.
3. The two Gatekeeper policies conflate the presence of labels and annotations with their values conforming to a specified regex. The Kyverno library has these as separate policies since the presence is more common than the regex.
