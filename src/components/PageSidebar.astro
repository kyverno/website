---
// Override Starlight's PageSidebar component to hide it on the Support page
import MobileTableOfContents from 'virtual:starlight/components/MobileTableOfContents'
import TableOfContents from 'virtual:starlight/components/TableOfContents'

// Get the current page slug
const currentSlug = Astro.url.pathname

// Hide sidebar on Support page
const isSupportPage = currentSlug === '/support/' || currentSlug === '/support'
const shouldShowToc = Astro.locals.starlightRoute?.toc && !isSupportPage
---

{
  shouldShowToc && (
    <>
      <div class="lg:sl-hidden">
        <MobileTableOfContents />
      </div>
      <div class="right-sidebar-panel sl-hidden lg:sl-block">
        <div class="sl-container">
          <TableOfContents />
        </div>
      </div>
    </>
  )
}

<style>
  @layer starlight.core {
    .right-sidebar-panel {
      padding: 1rem var(--sl-sidebar-pad-x);
    }
    .sl-container {
      width: calc(var(--sl-sidebar-width) - 2 * var(--sl-sidebar-pad-x));
    }
    .right-sidebar-panel :global(h2) {
      color: var(--sl-color-white);
    }
  }
</style>

<style is:global>
  /* Hide the entire right sidebar container on Support page */
  :global(body[data-slug='/support/'] .right-sidebar-container),
  :global(body[data-slug='/support'] .right-sidebar-container),
  :global(body[data-slug='/support/'] .right-sidebar),
  :global(body[data-slug='/support'] .right-sidebar),
  :global(body[data-slug='/support/'] .right-sidebar-panel),
  :global(body[data-slug='/support'] .right-sidebar-panel) {
    display: none !important;
    width: 0 !important;
    flex: 0 0 0 !important;
    padding: 0 !important;
    margin: 0 !important;
  }

  /* Make main content expand to full width */
  :global(body[data-slug='/support/'] .main-pane),
  :global(body[data-slug='/support'] .main-pane) {
    width: 100% !important;
    max-width: 100% !important;
  }

  /* Remove the margin that's applied when TOC is present */
  :global(
    body[data-slug='/support/'] [data-has-sidebar][data-has-toc] .main-pane
  ),
  :global(
    body[data-slug='/support'] [data-has-sidebar][data-has-toc] .main-pane
  ) {
    --sl-content-margin-inline: auto !important;
    width: 100% !important;
  }

  /* Increase content width and reduce padding on Support page */
  :global(body[data-slug='/support/'] .content-panel),
  :global(body[data-slug='/support'] .content-panel) {
    padding-left: 2rem !important;
    padding-right: 2rem !important;
  }

  :global(body[data-slug='/support/'] .sl-container),
  :global(body[data-slug='/support'] .sl-container) {
    max-width: 90rem !important; /* Much wider than default 45rem */
    margin-inline: auto !important;
  }

  @media (min-width: 72rem) {
    :global(body[data-slug='/support/'] .sl-container),
    :global(body[data-slug='/support'] .sl-container) {
      max-width: 90rem !important;
      margin-inline: auto !important;
    }
  }
</style>
