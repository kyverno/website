---
interface Props {
  policy: any
  baseUrl?: string
}

const { policy, baseUrl = '/policies' } = Astro.props

if (!policy) return null

const categoryLabels: Record<string, string> = {
  verifyImages: 'Verify Images',
  validate: 'Validate',
  mutate: 'Mutate',
  generate: 'Generate',
  cleanup: 'Cleanup',
}

const categoryColors: Record<string, string> = {
  verifyImages: 'bg-cyan-500/15 text-cyan-400 border-cyan-500/30',
  validate: 'bg-primary-100/15 text-primary-100 border-primary-100/30',
  mutate: 'bg-purple-500/15 text-purple-400 border-purple-500/30',
  generate: 'bg-emerald-500/15 text-emerald-400 border-emerald-500/30',
  cleanup: 'bg-orange-500/15 text-orange-400 border-orange-500/30',
}

const severityColors: Record<string, string> = {
  high: 'bg-red-500/10 text-red-400 border-red-500/20',
  medium: 'bg-yellow-500/10 text-yellow-400 border-yellow-500/20',
  low: 'bg-green-500/10 text-green-400 border-green-500/20',
}

const severityLabels: Record<string, string> = {
  high: 'High',
  medium: 'Medium',
  low: 'Low',
}

const category = policy.data.category || 'validate'
const severity = policy.data.severity || 'medium'
---

<div
  class="policy-card group bg-dark-50 border border-stroke rounded-2xl p-6 transition-all duration-300 cursor-pointer relative overflow-hidden hover:border-primary-100/50 hover:-translate-y-1 hover:shadow-[0_20px_40px_rgba(55,131,196,0.15)] before:content-[''] before:absolute before:top-0 before:left-0 before:right-0 before:h-[4px] before:bg-gradient-to-r before:from-primary-100 before:via-accent-100 before:to-primary-100 before:scale-x-0 before:transition-transform before:duration-300 hover:before:scale-x-100"
  data-category={category}
  data-severity={severity}
  data-resources={policy.data.subjects?.join(',') || ''}
  data-title={policy.data.title?.toLowerCase() || ''}
  data-tags={policy.data.tags?.join(',') || ''}
>
  <div class="flex justify-between items-start mb-5">
    <div class="w-full">
      <div class="flex gap-2 flex-wrap mb-4">
        <span
          class={`px-3 py-1.5 rounded-lg text-xs font-bold uppercase tracking-wider border backdrop-blur-sm ${categoryColors[category] || categoryColors.validate} shadow-sm`}
        >
          {categoryLabels[category] || category}
        </span>
        <span
          class={`px-3 py-1.5 rounded-lg text-xs font-bold uppercase tracking-wider border backdrop-blur-sm ${severityColors[severity] || severityColors.medium} shadow-sm`}
        >
          {severityLabels[severity] || severity}
        </span>
      </div>
      <h3
        class="text-xl font-bold mb-3 text-white leading-tight group-hover:text-primary-100 transition-colors"
      >
        <a
          href={`${baseUrl}/${policy.id}/`}
          class="hover:text-primary-100 transition-colors"
          data-astro-prefetch
        >
          {policy.data.title}
        </a>
      </h3>
    </div>
  </div>
  {
    policy.data.tags && policy.data.tags.length > 0 && (
      <div class="flex flex-wrap gap-2 mb-5">
        {policy.data.tags.map((tag: string) => (
          <span class="tag px-2.5 py-1 bg-stroke/60 backdrop-blur-sm rounded-lg text-xs text-white/70 transition-all hover:bg-primary-100/20 hover:text-primary-100 border border-stroke/50">
            #{tag}
          </span>
        ))}
      </div>
    )
  }
  <div
    class="flex flex-wrap gap-4 pt-5 border-t border-stroke/50 text-sm text-white/50 mb-5"
  >
    {
      policy.data.subjects && policy.data.subjects.length > 0 && (
        <div class="flex items-center gap-2">
          <svg
            width="16"
            height="16"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            class="text-primary-100/60"
          >
            <rect x="2" y="2" width="12" height="12" rx="1.5" />
          </svg>
          <span class="font-medium">
            {policy.data.subjects.slice(0, 3).join(', ')}
          </span>
          {policy.data.subjects.length > 3 && (
            <span class="text-white/30">...</span>
          )}
        </div>
      )
    }
    {
      policy.data.version && (
        <div class="flex items-center gap-2">
          <svg
            width="16"
            height="16"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            class="text-primary-100/60"
          >
            <path d="M8 2v12M2 8h12" />
          </svg>
          <span class="font-medium">v{policy.data.version}+</span>
        </div>
      )
    }
  </div>
  <div class="flex gap-2 mt-5">
    <a
      href={`${baseUrl}/${policy.id}/`}
      class="action-btn flex-1 py-3 bg-gradient-to-r from-stroke to-stroke/80 border border-primary-100/20 rounded-lg text-white text-sm font-medium cursor-pointer transition-all flex items-center justify-center gap-2 hover:from-primary-100/20 hover:to-primary-100/10 hover:border-primary-100/50 hover:shadow-lg hover:shadow-primary-100/10"
      data-astro-prefetch
    >
      <svg
        width="18"
        height="18"
        fill="none"
        stroke="currentColor"
        stroke-width="2.5"
      >
        <path d="M9 2v14M2 9h14"></path>
      </svg>
      View Details
    </a>
  </div>
</div>
